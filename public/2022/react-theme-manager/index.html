<!DOCTYPE html>
<html>
    <head>
<title> React Theme Manager &middot; Tilemoon Blog </title>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/tocbot@4.18.2/dist/tocbot.min.js"></script>
<link type="text/css" href="https://cdn.jsdelivr.net/npm/tocbot@4.18.2/dist/tocbot.css">
<link type="text/css" href="https://cdn.jsdelivr.net/npm/tocbot@4.18.2/dist/styles.css">
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="keywords" content="github,">
<meta name="description" content="tilemoon blog">


<link rel="stylesheet" href="https://tilemoon.life/css/index.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
<link rel='shortcut icon' type='image/x-icon' href='/images/favicon.ico' />
</head>
    <body class="theme-light"><header>
  <div class="header-leading space-s">
    <a class="action-btn" href="//github.com/tilemoon" target="_blank">
      <i class="fa fa-github fa-lg" aria-hidden="true"></i>
    </a>
  </div>
  <div class="header-menus space-m">
    
      <a class="header-menu-item" href="/">Home</a>
    
      <a class="header-menu-item" href="/archive">Archive</a>
    
      <a class="header-menu-item" href="/profile">Profile</a>
    
  </div>
  <div class="header-actions space-s">
    <button id="theme-toggle" class="action-btn" onclick="toggleTheme()">
      <i class="fa fa-sun-o fa-lg" aria-hidden="true"></i>
    </button>
  </div>
</header>
<main id="main">
<div class="content">
  <div class="table-of-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#è®¾è®¡">è®¾è®¡</a></li>
    <li><a href="#ä»£ç å®ç°">ä»£ç å®ç°</a>
      <ul>
        <li><a href="#themeprovider">ThemeProvider</a></li>
        <li><a href="#render-theme">Render Theme</a></li>
        <li><a href="#usetheme">useTheme</a></li>
      </ul>
    </li>
    <li><a href="#å®è·µä¼˜åŒ–">å®è·µä¼˜åŒ–</a>
      <ul>
        <li><a href="#usetheme-ç±»å‹è¡¥å…¨">useTheme ç±»å‹è¡¥å…¨</a></li>
        <li><a href="#inline-style-æ”¯æŒ">inline style æ”¯æŒ</a></li>
        <li><a href="#colors-ç±»å‹æç¤º">colors ç±»å‹æç¤º</a></li>
      </ul>
    </li>
    <li><a href="#ç»†èŠ‚æ‰“ç£¨">ç»†èŠ‚æ‰“ç£¨</a>
      <ul>
        <li><a href="#æ¸å˜è½¬æ¢">æ¸å˜è½¬æ¢</a></li>
        <li><a href="#å­˜å‚¨ä¸Šæ¬¡ä¸»é¢˜">å­˜å‚¨ä¸Šæ¬¡ä¸»é¢˜</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>

  <section class="single-post markdown-body">
    <h1 class="single-post-title"><a href="https://tilemoon.life/2022/react-theme-manager/">React Theme Manager</a></h1>
    <div class="single-post-date">2022-08-07 01:48</div>
    <div class="single-post-content">
      <p>å¦‚ä½•ç”¨ React å®ç°ä¸€å¥—å®Œæ•´çš„ä¸»é¢˜åˆ‡æ¢æ–¹æ¡ˆ</p>
<h2 id="è®¾è®¡">è®¾è®¡</h2>
<p>åƒè¿™ç§å…¨å±€é…ç½®çš„åœºæ™¯ï¼Œç”¨ <code>context</code> æ¥å®ç°åŸºæœ¬ä¸Šæ˜¯å†é€‚åˆä¸è¿‡äº†ï¼Œæ‰€ä»¥å¤§è‡´æ€è·¯å°±æ˜¯ï¼š</p>
<ul>
<li>ç”Ÿäº§ç«¯ï¼šä½¿ç”¨ <code>context provider</code> å®ç° <code>ThemeManagerProvider</code></li>
<li>é…ç½®ç«¯ï¼šç”¨æˆ·å¯ä»¥åŸºäºæä¾›çš„åŸºæœ¬é…ç½®ç±»å‹ <code>ThemeConfig</code> æ¥é…ç½®è‡ªå·±çš„ä¸»é¢˜ç±»å‹</li>
<li>æ¶ˆè´¹ç«¯ï¼šä½¿ç”¨ <code>useContext</code> å®ç° <code>useTheme</code></li>
</ul>
<p>æ¥ä¸‹æ¥è€ƒè™‘çš„å°±æ˜¯ <code>ThemeConfig</code> éœ€è¦æ”¯æŒå“ªäº›å†…å®¹ï¼Œåœ¨æˆ‘çœ‹æ¥è‡³å°‘éœ€è¦æ”¯æŒä¸‹é¢è¿™äº›å†…å®¹ï¼š</p>
<ul>
<li>æœ€åŸºæœ¬çš„éœ€è¦æ”¯æŒ <code>colors</code> çš„é…ç½®ï¼Œæä¾›ä¸åŒä¸»é¢˜ä¸‹çš„é¢œè‰²ä½¿ç”¨</li>
<li>åŠ¨æ€çš„ css å¯¼å…¥ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹ä½¿ç”¨ç¬¬ä¸‰æ–¹ cdn css çš„æ—¶å€™ï¼Œå¯èƒ½éœ€è¦æä¾›ä¸åŒçš„ css åœ°å€</li>
<li>å…¶ä»–å„ç§è‡ªå®šä¹‰å­—æ®µçš„é…ç½®ï¼Œæ¯”å¦‚ iconï¼Œå›¾ç‰‡è¿™äº›å†…å®¹ï¼Œè¿™äº›å†…å®¹ç”¨æˆ·è‡ªå·±é…ç½®å³å¯</li>
</ul>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<h3 id="themeprovider">ThemeProvider</h3>
<p>æ ¹æ®æˆ‘ä»¬çš„åŸºæœ¬æ€è·¯ï¼Œä½¿ç”¨ <code>React.createContext()</code> æ„å»ºä¸€ä¸ª context å¯¹è±¡ï¼Œç„¶åå°†å…¶ <code>Provider</code> åŒ…è£…ä¸€ä¸‹å³å¯ï¼Œ
å¤§è‡´çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ThemeManagerProps</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme</span>: <span style="color:#66d9ef">ThemeConfig</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">setTheme</span>: <span style="color:#66d9ef">React.Dispatch</span>&lt;<span style="color:#f92672">React.SetStateAction</span><span style="color:#960050;background-color:#1e0010">&lt;</span><span style="color:#a6e22e">ThemeConfig</span>&gt;<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ctx</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">React</span>.<span style="color:#a6e22e">createContext</span>&lt;<span style="color:#f92672">ThemeManagerProps</span>&gt;({} <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">ThemeManagerProps</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ThemeManagerProviderProps</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">defaultTheme</span>: <span style="color:#66d9ef">ThemeConfig</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">children</span>: <span style="color:#66d9ef">React.ReactNode</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">React</span>.<span style="color:#a6e22e">ReactNode</span>[]
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ThemeManagerProvider</span>: <span style="color:#66d9ef">React.FC</span>&lt;<span style="color:#f92672">ThemeManagerProviderProps</span>&gt; <span style="color:#f92672">=</span> ({ <span style="color:#a6e22e">defaultTheme</span>, <span style="color:#a6e22e">children</span> }) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">theme</span>, <span style="color:#a6e22e">setTheme</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">React</span>.<span style="color:#a6e22e">useState</span>&lt;<span style="color:#f92672">ThemeConfig</span>&gt;(<span style="color:#a6e22e">defaultTheme</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">React</span>.<span style="color:#a6e22e">useEffect</span>(() <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// TODOï¼šè¿™é‡Œå¾…ä¼šéœ€è¦å®ç°å¯¹äºä¸»é¢˜çš„æ¸²æŸ“æ“ä½œ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// æ¯”å¦‚è®¾ç½® css å˜é‡ï¼Œè·å– css é“¾æ¥ ç­‰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">renderTheme</span>(<span style="color:#a6e22e">theme</span>)
</span></span><span style="display:flex;"><span>  }, [<span style="color:#a6e22e">theme</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> &lt;<span style="color:#f92672">ctx.Provider</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span>{{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">theme</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">setTheme</span>,
</span></span><span style="display:flex;"><span>  }}&gt;
</span></span><span style="display:flex;"><span>    {<span style="color:#a6e22e">children</span>}
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">ctx.Provider</span>&gt;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">default</span> <span style="color:#a6e22e">ctx</span>
</span></span></code></pre></div><h3 id="render-theme">Render Theme</h3>
<p>Theme çš„æ¸²æŸ“æœ€ä¸»è¦çš„å°±æ˜¯å°†è®¾ç½®å¥½çš„ colors è®¾ç½®åˆ°æµè§ˆå™¨ä¸­ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬éœ€è¦åšå‡ ä»¶äº‹æƒ…ï¼š</p>
<ol>
<li>å°†å˜é‡åä»é©¼å³°è½¬æ¢æˆ css variable ä½¿ç”¨çš„æ ¼å¼ï¼Œeg: <code>primaryColor -&gt; --primary-color</code></li>
<li>è®© css å˜é‡ç”Ÿæ•ˆ</li>
</ol>
<p>è½¬é©¼å³°çš„é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨ <code>replace</code> æ–¹æ³• + æ­£åˆ™å³å¯å®Œæˆ:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#75715e">// convert camel-style variable to css variable style
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// eg: primaryColor --&gt; --primary-color
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">convertCamelToCssVar</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">camelName</span>: <span style="color:#66d9ef">string</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;--&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">camelName</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">/([A-Z])/</span>, (<span style="color:#a6e22e">$</span>) <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#39;-&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">toLowerCase</span>())
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æ¥ä¸‹æ¥å°±æ˜¯è®©å˜é‡ç”Ÿæ•ˆï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Web/API/CSSStyleSheet/insertRule"><code>CSSStyleSheet.insertRule</code></a> æ¥å®ç°æ’å…¥ css çš„æ“ä½œï¼Œä¸ºäº†ä¸åœ¨æ¯æ¬¡åˆ‡æ¢ä¸»é¢˜çš„æ—¶å€™éƒ½ä¼šé‡å¤çš„æ’å…¥ styleï¼Œè¿™é‡Œéœ€è¦ä½¿ç”¨
ä¸€ä¸ªå›ºå®šçš„ <code>id</code>ï¼Œå½“å‘ç”Ÿåˆ‡æ¢çš„æ—¶å€™ï¼Œéœ€è¦å°†ä¹‹å‰çš„ style ç§»é™¤ï¼Œä¿è¯åªæœ‰æ–°çš„ style ç”Ÿæ•ˆã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ThemeConfig</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">colors</span>: <span style="color:#66d9ef">Record</span>&lt;<span style="color:#f92672">string</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#a6e22e">string</span>&gt;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">THEME_STYLE_ID</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;theme-style&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">renderTheme</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">theme</span>: <span style="color:#66d9ef">ThemeConfig</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/// check if there exist theme style or not
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">/// if there is, delete first
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">existStyle</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">`style#</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">THEME_STYLE_ID</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">existStyle</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">existStyle</span>.<span style="color:#a6e22e">remove</span>()
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">style</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;style&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">THEME_STYLE_ID</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  document.<span style="color:#a6e22e">head</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">style</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">sheet</span><span style="color:#f92672">?</span>.<span style="color:#a6e22e">insertRule</span>(<span style="color:#e6db74">`:root {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    </span><span style="color:#e6db74">${</span>Object.<span style="color:#a6e22e">entries</span>(<span style="color:#a6e22e">theme</span>.<span style="color:#a6e22e">colors</span>).<span style="color:#a6e22e">map</span>(([<span style="color:#a6e22e">k</span>, <span style="color:#a6e22e">v</span>])<span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">`</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">convertCamelToCssVar</span>(<span style="color:#a6e22e">k</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">v</span><span style="color:#e6db74">}</span><span style="color:#e6db74">;`</span>).<span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#39;\n&#39;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }`</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="usetheme">useTheme</h3>
<p><code>useTheme</code> çš„å®ç°ä¹Ÿéå¸¸ç®€å•ï¼Œç›´æ¥è¿”å› ctx çš„å†…å®¹å³å¯</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">useTheme</span> <span style="color:#f92672">=</span> ()<span style="color:#f92672">:</span> <span style="color:#a6e22e">ThemeManagerProps</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">useContext</span>(<span style="color:#a6e22e">ctx</span>)
</span></span></code></pre></div><h2 id="å®è·µä¼˜åŒ–">å®è·µä¼˜åŒ–</h2>
<p>æ¥ä¸‹æ¥å°±æ˜¯åœ¨å®é™…çš„é¡¹ç›®ä¸­ä½¿ç”¨æˆ‘ä»¬å†™çš„ä¸»é¢˜ç®¡ç†äº†ï¼Œä¸‹é¢æ˜¯æˆ‘ç®€å•å®šä¹‰çš„ä¸¤ä¸ªä¸»é¢˜ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">MyThemeConfig</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ThemeConfig</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span>: <span style="color:#66d9ef">string</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ThemeLight</span>: <span style="color:#66d9ef">MyThemeConfig</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;light&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">colors</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fontColor</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;black&#39;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">backgroundColor</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;white&#39;</span>,
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ThemeDark</span>: <span style="color:#66d9ef">MyThemeConfig</span> <span style="color:#f92672">=</span> ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">themes</span>: <span style="color:#66d9ef">Record</span>&lt;<span style="color:#f92672">string</span><span style="color:#960050;background-color:#1e0010">,</span> <span style="color:#a6e22e">MyThemeConfig</span>&gt; <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">light</span>: <span style="color:#66d9ef">ThemeLight</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">dark</span>: <span style="color:#66d9ef">ThemeDark</span>,
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ç”Ÿäº§ç«¯ä½¿ç”¨ <code>ThemeManagerProvider</code>ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span>  &lt;<span style="color:#f92672">ThemeManagerProvider</span> <span style="color:#a6e22e">defaultTheme</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">themes</span>.<span style="color:#a6e22e">light</span>}&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">App</span> /&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">ThemeManagerProvider</span>&gt;
</span></span></code></pre></div><h3 id="usetheme-ç±»å‹è¡¥å…¨">useTheme ç±»å‹è¡¥å…¨</h3>
<p>æ¶ˆè´¹ç«¯ä½¿ç”¨ <code>useTheme</code>ï¼Œè¿™é‡Œæˆ‘é©¬ä¸Šå°±é‡åˆ°äº†ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºæˆ‘ä»¬çš„ä»£ç ä¸­å…¨éƒ¨éƒ½æ˜¯ä½¿ç”¨ <code>ThemeConfig</code> æ¥ä½œä¸º Theme çš„
ç±»å‹ï¼Œåœ¨ <code>useTheme</code> ä¸­æ‹¿åˆ°çš„ <code>theme</code> å¹¶ä¸æ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ <code>MyThemeConfig</code>ï¼Œæ‰€ä»¥å°±æ— æ³•è®¿é—®é‡Œé¢çš„ <code>name</code> å±æ€§</p>
<p><img src="/images/theme-config-no-property.jpg" alt="ThemeConfig no property"></p>
<p>å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿå› ä¸ºæˆ‘ä»¬æ²¡åŠæ³•å¼ºåˆ¶å®šä¹‰ç”¨æˆ·è¦ä½¿ç”¨çš„ Theme ç±»å‹ï¼Œè¿™ä¸ªæ—¶å€™ <a href="https://www.typescriptlang.org/docs/handbook/2/generics.html"><code>èŒƒå‹</code></a>å°±æ´¾ä¸Šç”¨åœºäº†</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#75715e">// Provider
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ThemeManagerProps</span>&lt;<span style="color:#f92672">T</span> <span style="color:#a6e22e">extends</span> <span style="color:#a6e22e">ThemeConfig</span>&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">theme</span>: <span style="color:#66d9ef">T</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">setTheme</span>: <span style="color:#66d9ef">React.Dispatch</span>&lt;<span style="color:#f92672">React.SetStateAction</span><span style="color:#960050;background-color:#1e0010">&lt;</span><span style="color:#a6e22e">T</span>&gt;<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ç”±äºè¿™é‡Œå¹¶æ²¡æœ‰ä»€ä¹ˆæ–¹å¼å¯ä»¥è®©ç”¨æˆ·æŠŠç±»å‹ç»™ä¼ è¿›æ¥ï¼Œæ‰€ä»¥è¿™é‡Œå°±å†™ any å³å¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ctx</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">React</span>.<span style="color:#a6e22e">createContext</span>&lt;<span style="color:#f92672">ThemeManagerProps</span><span style="color:#960050;background-color:#1e0010">&lt;</span><span style="color:#a6e22e">any</span>&gt;<span style="color:#f92672">&gt;</span>({} <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">ThemeManagerProps</span>&lt;<span style="color:#f92672">any</span>&gt;)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// useTheme
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">useTheme</span> <span style="color:#f92672">=</span> &lt;<span style="color:#f92672">T</span> <span style="color:#a6e22e">extends</span> <span style="color:#a6e22e">ThemeConfig</span>&gt;()<span style="color:#f92672">:</span> <span style="color:#a6e22e">ThemeManagerProps</span>&lt;<span style="color:#f92672">T</span>&gt; <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">useContext</span>(<span style="color:#a6e22e">ctx</span>)
</span></span></code></pre></div><p>ä½¿ç”¨èŒƒå‹æ”¹å†™åï¼Œå†ä½¿ç”¨ <code>useTheme&lt;MyThemeConfig&gt;()</code> å°±å¯ä»¥å®Œç¾æ”¯æŒè‡ªå®šä¹‰çš„ä¸»é¢˜ç±»å‹äº†ã€‚</p>
<p>ç›®å‰å’±ä»¬çš„ä¸»é¢˜åˆ‡æ¢æ•ˆæœï¼š</p>
<p><img src="/images/theme-manager-sample1.gif" alt="ThemeManager Sample"></p>
<p>æˆªæ­¢ç›®å‰ï¼Œæ•´ä¸ªä¸»é¢˜ç®¡ç†å·²ç»å¯ä»¥æ­£å¸¸çš„è¿è¡Œäº†ğŸ‰ğŸ‰ğŸ‰</p>
<h3 id="inline-style-æ”¯æŒ">inline style æ”¯æŒ</h3>
<p>åœ¨æŸäº›æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨å†™æ ·å¼ä¸ºäº†å›¾æ–¹ä¾¿ä¼šç›´æ¥å†™åœ¨ <code>style</code> ä¸­ï¼Œæ•´ä¸ªæ—¶å€™å†å»å†™ <code>var(--font-color)</code> è¿™ç§å†™æ³•å°±æ˜¾å¾—ä¸æ˜¯å¾ˆå‹å¥½äº†ï¼Œ
æ‰€ä»¥æˆ‘ä»¬éœ€è¦æä¾›ä¸€ç§æ–¹å¼èƒ½å¤Ÿç›´æ¥è¯»åˆ°å¯¹åº”çš„å˜é‡ï¼Œæ¯”è¾ƒç®€å•ç²—æš´çš„æ–¹å¼å°±æ˜¯ç›´æ¥å¢åŠ ä¸€ä¸ªè½¬æ¢æ–¹æ³•å³å¯ï¼Œå®ç°å¦‚ä¸‹</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">v</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">colorName</span>: <span style="color:#66d9ef">string</span>) <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">`var(</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">convertCamelToCssVar</span>(<span style="color:#a6e22e">colorName</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">)`</span>
</span></span></code></pre></div><p>è¿™æ ·åœ¨å†™ style çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>v(theme.colors.xxx)</code> å³å¯</p>
<h3 id="colors-ç±»å‹æç¤º">colors ç±»å‹æç¤º</h3>
<p>ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ä¼šå‘ç°ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ <code>colors</code> çš„æ—¶å€™ï¼Œts å¹¶ä¸ä¼šå‘Šè¯‰æˆ‘ä»¬å…¶ä¸­æœ‰å“ªäº›å­—æ®µï¼Œè¿™æ ·æˆ‘ä»¬éœ€è¦ç»å¸¸å»æŸ¥ï¼Œ
æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¹Ÿéœ€è¦ä½¿ç”¨èŒƒå‹å¯¹å…¶è¿›è¡Œæ”¹é€ </p>
<p>ç¬¬ä¸€æ­¥ï¼šæ”¹é€  <code>ThemeConfig</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ThemeConfig</span>&lt;<span style="color:#f92672">T</span> <span style="color:#960050;background-color:#1e0010">=</span> {}&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">colors</span>: <span style="color:#66d9ef">T</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ç¬¬äºŒæ­¥ï¼šæ”¹é€  <code>MyThemeConfig</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ThemeColors</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">fontColor</span>: <span style="color:#66d9ef">string</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">backgroundColor</span>: <span style="color:#66d9ef">string</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">MyThemeConfig</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ThemeConfig</span>&lt;<span style="color:#f92672">ThemeColors</span>&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span>: <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ç»è¿‡è¿™ä¸¤æ­¥æ”¹é€ ä¹‹åï¼Œåœ¨è¯»å– theme ä¸­çš„ <code>colors</code> å°±å¯ä»¥å®Œç¾çš„äº«å—ç±»å‹æç¤ºäº†</p>
<p><img src="/images/theme-colors-fix.jpg" alt="Theme Colors Fix"></p>
<h2 id="ç»†èŠ‚æ‰“ç£¨">ç»†èŠ‚æ‰“ç£¨</h2>
<h3 id="æ¸å˜è½¬æ¢">æ¸å˜è½¬æ¢</h3>
<p>ç›®å‰çš„ä¸»é¢˜åˆ‡æ¢ï¼Œé¢œè‰²çš„è¿‡æ¸¡ä¼šéå¸¸ç”Ÿç¡¬ï¼Œæ‰€ä»¥å¯ä»¥åŠ ä¸Šä¸€å®šçš„è¿‡æ¸¡åŠ¨ç”»æ¥è®©å…¶å˜å¾—èˆ’æœäº›ã€‚</p>
<p>æ€è·¯å…¶å®éå¸¸ç®€å•ï¼Œç›´æ¥ç»™æ‰€æœ‰çš„å…ƒç´ éƒ½åŠ ä¸Š <code>transition</code> å³å¯ï¼Œå’Œæ’å…¥ Theme Style ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œ
åªéœ€è¦æ’å…¥ä¸€æ¬¡å°±å¯ä»¥äº†</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">insertTransitionStyle</span> <span style="color:#f92672">=</span> () <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/// check if there exist theme style or not
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">/// if there is, return
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">existStyle</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">`style#</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">TRANSITION_STYLE_ID</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">existStyle</span>) <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">style</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;style&#39;</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">TRANSITION_STYLE_ID</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  document.<span style="color:#a6e22e">head</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">style</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">style</span>.<span style="color:#a6e22e">sheet</span><span style="color:#f92672">?</span>.<span style="color:#a6e22e">insertRule</span>(<span style="color:#e6db74">`* {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    transition-property: color, background-color, border;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    transition-duration: 0.15s;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    transition-timing-function: ease-out;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  }`</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æ”¹é€ åçš„æ•ˆæœï¼š
<img src="/images/theme-manager-transition.gif" alt="ThemeManager Transition"></p>
<h3 id="å­˜å‚¨ä¸Šæ¬¡ä¸»é¢˜">å­˜å‚¨ä¸Šæ¬¡ä¸»é¢˜</h3>
<p>å½“ç„¶ï¼Œåœ¨ç”¨æˆ·åˆ‡æ¢ä¸»é¢˜ä¹‹åï¼Œæœ€å¥½æ˜¯å¯ä»¥è®°å½•ä¸€ä¸‹ç”¨æˆ·ä¸Šä¸€æ¬¡å­˜å‚¨çš„ä¸»é¢˜ï¼Œå¾ˆæ˜æ˜¾è¿™é‡Œç›´æ¥ä½¿ç”¨ <code>localStorage</code> è®°å½•ä¸‹
ä¸Šæ¬¡åˆ‡æ¢çš„ä¸»é¢˜ï¼Œå¹¶åœ¨åˆå§‹åŒ–çš„æ—¶å€™è¯»å–å³å¯</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">ThemeConfig</span> } <span style="color:#66d9ef">from</span> <span style="color:#e6db74">&#34;./theme-render&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">THEME_STORAGE_KEY</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;theme&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">load</span> <span style="color:#f92672">=</span> ()<span style="color:#f92672">:</span> <span style="color:#a6e22e">ThemeConfig</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">themeJson</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">localStorage</span>.<span style="color:#a6e22e">getItem</span>(<span style="color:#a6e22e">THEME_STORAGE_KEY</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">themeJson</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#a6e22e">themeJson</span>) <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">ThemeConfig</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">save</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">theme</span>: <span style="color:#66d9ef">ThemeConfig</span>) <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">localStorage</span>.<span style="color:#a6e22e">setItem</span>(<span style="color:#a6e22e">THEME_STORAGE_KEY</span>, <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>(<span style="color:#a6e22e">theme</span>))
</span></span></code></pre></div><p>Provider æ”¹åŠ¨ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tsx" data-lang="tsx"><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ThemeManagerProvider</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">props</span>) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> [<span style="color:#a6e22e">theme</span>, <span style="color:#a6e22e">setTheme</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">React</span>.<span style="color:#a6e22e">useState</span>(<span style="color:#a6e22e">load</span>() <span style="color:#f92672">??</span> <span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">defaultTheme</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">React</span>.<span style="color:#a6e22e">useEffect</span>(() <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">save</span>(<span style="color:#a6e22e">theme</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">renderTheme</span>(<span style="color:#a6e22e">theme</span>)
</span></span><span style="display:flex;"><span>  }, [<span style="color:#a6e22e">theme</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>å®Œæ•´çš„é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/tilemoon/react-theme-manager">react-theme-manager</a></p>
    </div>
  </section>
</div>
<script>
  tocbot.init({
    tocSelector: '.table-of-content',
    contentSelector: '.single-post-content',
    headingSelector: 'h1, h2',
    hasInnerContainers: true,
    scrollSmoothOffset: -64,
    headingsOffset: 64,
  });
</script>

        </main><div  class="footer">
  Copyright Â© 2021-2022 | <a href="https://beian.miit.gov.cn/" target="_blank">é„‚ICPå¤‡2022007117å·-1</a>
</div>
<script type="text/javascript" src="https://tilemoon.life/js/index.js"></script>
    </body>
</html>
